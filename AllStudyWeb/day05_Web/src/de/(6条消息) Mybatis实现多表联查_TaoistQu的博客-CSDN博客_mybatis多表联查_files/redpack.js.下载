"use strict";!function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=new Date(e).getFullYear(),n=new Date(e).getMonth()+1,o=new Date(e).getDate();return""+t+(n<10?"0"+n:n)+(o<10?"0"+o:o)}function t(e,t,n){var o=new Date;if(-1==n)return void(document.cookie=e+"="+escape(t)+";domain=.csdn.net;path=/");if(n)o.setTime(o.getTime()+n);else{o.setTime(o.getTime()+2592e6)}document.cookie=e+"="+t+";expires="+o.toGMTString()+";domain=.csdn.net;path=/"}function n(e){for(var t=document.cookie.split("; "),n=0;n<t.length;n++){var o=t[n].split("=");if(o[0]==e&&"UD"==e)return decodeURIComponent(o[1]);if(o[0]==e)return decodeURI(o[1])}}function o(e){if(!e)return!1;var t=(new Date).getTime(),n=new Date(e.startTime.replace(/-/g,"/"));return t<=new Date(e.endTime.replace(/-/g,"/"))&&t>=n}function i(e){return!!e&&(new Date).getTime()>new Date(e.endTime.replace(/-/g,"/")).getTime()}function d(){return!!n("UserName")}function c(){return!n("redpack_close_time")}function a(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPod","iPad"],n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}function r(e){window.csdn&&window.csdn.report&&window.csdn.report.reportClick(e)}function s(e){window.csdn&&window.csdn.report&&window.csdn.report.reportView(e)}function l(){window.csdn&&window.csdn.report&&window.csdn.report.viewCheck()}function p(){this.el=null,this.timer=null,this.rains=[],this.density=300,this.maxCount=Math.floor(2*Math.random()+1),this.maxTime=10,this.timeLineTimer=null,this.currentRedPackId=null,this.timeBoxtimer=null,this.giftId=null,this.host="https://mp-luckydraw1.csdn.net",this.localRedPackIdTime=18e5,this.dev=!1,this.abandonRed=!1,this.autoTimeout=null,this.courentId="",this.nextStart="",this.redpackCheckTimer=null,this.getRedPackInfo()}void 0;var u=(/Safari/.test(navigator.userAgent)&&/Chrome/.test(navigator.userAgent),[]);p.prototype.initRedPack=function(e){return this.destory(),this.currentRedPackId=e.id,void 0,this.render(),c()?u.indexOf(e.id)>=0?(void 0,void this.destory()):(u.push(e.id),void this.timeOut(e.id).startRedpack(e.id)):(void 0,void this.destory())},p.prototype.timeOut=function(e){void 0;var t=this;return t.timeBox.show(),t.timeBoxtimer=setInterval(function(){return void 0,!t.timeBox||t.timeBox.is(":hidden")?(void 0,void clearInterval(t.timeBoxtimer)):--t.maxTime<0&&t.timeBoxtimer?(t.stopRedpack(e),void clearInterval(t.timeBoxtimer)):void t.timeBox.html("00:"+(t.maxTime<10?"0"+t.maxTime:t.maxTime))},1e3),this},p.prototype.render=function(){var e=this;return this.el=$('<div id="csdn-redpack" class="csdn-redpack-container"><span class="csdn-redpack-time">00:10</span><em class="csdn-redpack-close"></em></div>'),this.timeBox=this.el.find(".csdn-redpack-time"),this.closeBtn=this.el.find(".csdn-redpack-close"),this.closeBtn.on("click",function(n){return e.destory(),d()?(e.sendGift(),t("redpack",e.courentId,e.localRedPackIdTime),t("redpack_close_time",1,864e5)):t("redpack_close_time",1,36e5),t("redpack_out_time",e.nextStart,36e5),n.stopPropagation(),!1}),$("body").append(this.el),this},p.prototype.renderBeforeRedpack=function(e){var n=this,o=$('<div class="csdn-redpack-before">\n                  <span class="csdn-redpack-enter"></span>\n                  <span class="csdn-redpack-leave"></span>\n                </div>');return o.find(".csdn-redpack-leave").on("touchstart",function(e){return d()&&t("redpack",n.currentRedPackId,n.localRedPackIdTime),n.destory().getRedPackInfo(),e.stopPropagation(),!1}),o.find(".csdn-redpack-enter").on("touchstart",function(t){if(!d())return void(window.location.href="https://passport.csdn.net/account/login?utm_source=redpack&from="+encodeURIComponent(window.location.href));o.remove(),n.timeOut(e).startRedpack(e)}),n.el.append(o),n},p.prototype.createRedpack=function(e){var n=this,o=$('<div class="csdn-redpack"></div>'),i=a()?Math.max(1.5-Math.random(),.9):Math.max(1.7-Math.random(),1.2),c=(a(),a(),{width:56*i,height:72*i,left:Math.random()*(n.el.width()-30),top:-72*i*1.2});o.css(c),o.on("mousedown",function(o){if(!d())return t("redpack_unlogin_click",e,n.localRedPackIdTime),void(window.location.href="https://passport.csdn.net/account/login?utm_source=redpack&from="+encodeURIComponent(window.location.href));$(this).addClass("csdn-redpacked"),n.maxCount--,n.maxCount<=0&&n.stopRedpack(e),r({spm:"3001.6027"})}),n.el.append(o),n.moveRedpack(o),n.rains.push(o)},p.prototype.startRedpack=function(e){void 0;var t=this;return t.timer=setInterval(function(){t.createRedpack(e)},t.density),this},p.prototype.stopRedpack=function(e){return void 0,clearInterval(this.timer),clearInterval(this.timeBoxtimer),this.timeBox&&this.timeBox.remove(),this.closeBtn&&this.closeBtn.remove(),this.el&&this.el.find(".csdn-redpack").remove(),t("redpack_out_time",this.nextStart,36e5),this.maxCount<1?this.luckyBoy(e):d()?(t("redpack",e,this.localRedPackIdTime),$("#csdn-redpack").remove(),this.sendGift()):(t("redpack",e,this.localRedPackIdTime),this.renderResult()),this},p.prototype.moveRedpack=function(e){var t=this,n=Math.random()+2.5,o=Math.random()-.45,i=0,d=0,c=t.el.height()||1500,a=function t(){i-=1.2*o,d+=1.2*n,e.css({transform:"translate3d("+i+"px, "+d+"px, 0)"}),d>c?e.remove():requestAnimationFrame(t)};requestAnimationFrame(a)},p.prototype.getRedPackInfo=function(){void 0,void 0;var a=this;return window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.close(),c()?n("redpack_out_time")&&!i({endTime:n("redpack_out_time")})?(a.destory(),window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.show(),void a.redpackCheck()):(void 0,$("#csdn-redpack").remove(),$(".csdn-redpack-container").remove(),void $.ajax({url:a.host+"/luckydraw/api/lotteryInProgress",type:"get",data:{bizNo:"download",targetId:e(),username:n("UserName")||""},contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(e){if(a.dev&&(e={code:200,data:{current:null,next:{id:212,startTime:"2021/05/08 17:41:00",endTime:"2021/05/10 18:50:00"}}}),200===e.code&&e.data){var i=e.data,d=void 0;a.nextStart="",i.current&&i.current.options&&(a.giftId=JSON.parse(i.current.options).couponLotteryId,a.nextStart=i.current.endTime),a.courentId=i.current&&i.current.id?i.current.id:"",i.current&&!a.isShowedRedpack(i.current.id)?(d=i.current,void 0):i.next&&!a.isShowedRedpack(i.next.id)&&(d=i.next,void 0),i.next&&(a.nextStart=i.next.startTime),d||void 0,i.current&&!n("redpack")||window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.show(),d||(i.next?t("redpack_out_time",i.next.startTime,36e5):i.current&&t("redpack_out_time",i.current.endTime,36e5)),!i.current&&i.next&&t("redpack_out_time",i.next.startTime,36e5),o(d)&&a.currentRedPackId!==d.id&&(window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.close(),d.autoStart?(setTimeout(function(){a.initRedPack(d)},0),r({spm:"3001.6145"}),s({spm:"3001.6145"})):setTimeout(function(){a.renderSelectWindow(d)},0)),a.timeLine(d)}}})):(a.destory(),void(window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.show()))},p.prototype.luckyBoy=function(e){void 0;var t=this;$.ajax({url:t.host+"/luckydraw/api/timesWin",type:"post",data:JSON.stringify({lotteryId:e,username:n("UserName")}),contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(e){t.dev&&(e={code:200,data:{prizeId:"123",name:"coupon",url:"",money:"0.01"}}),200===e.code&&e.data?t.abandonRed?t.renderNoluck(e.data):t.renderResult(e.data):t.renderResult({prizeId:null})}})},p.prototype.renderResult=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0;var n=this,o=a();if(!c())return void n.destory();var i="csdn-redpack-sorry",d="",l="整点开始下一场！";e.options=e.options?JSON.parse(e.options):"",void 0;var p=2===e.type?'<div class="csdn-redpack-article">\n      <div>\n        <img src="'+e.picUrl+'" />\n        <span>'+e.title+"</span>\n      </div>\n      <p>您可点击私信-VIP小助手，按照提示填写收货信息</p>\n    </div>":"",u=e.options.couponText?'<div class="csdn-redpack-coupon">\n      <div class="csdn-redpack-coupon-left">\n        <span>'+e.options.couponText.typeText+"</span>\n        <p><span>¥</span>"+e.options.amount+'</p>\n      </div>\n      <div class="csdn-redpack-coupon-right">\n        <p>'+e.options.couponText.text+"</p>\n        <p>"+e.options.couponText.textDesc+"</p>\n        <p>活动期间可用，在我的钱包查看</p>\n      </div>\n    </div>":"",m='<div class="csdn-redpack-packet">\n      <p class="csdn-redpack-packet-title">'+e.options.title+'</p>\n      <div class="csdn-redpack-packet-middle">\n        <em></em><span><span>¥</span>'+e.money+"</span>\n      </div>\n      <p>已自动放入您的钱包内，购买全站付费商品均可用</p>\n    </div>";d='<div class="csdn-redpack-noluck">\n      <div class="csdn-redpack-noluck-area">\n        <em></em><span>本场红包雨已结束</span>\n      </div>\n      <p>本场红包已结束，等待下一场吧～</p>\n    </div>',2===e.type?(i="csdn-redpack-article",d=p,l="再获得1次抽奖机会"):e.prizeId&&"common-coupon"===e.name?(i="csdn-redpack-common-coupon",d=u,l="立即使用"):e.prizeId&&"coupon"===e.name?(i="csdn-redpack-coupon",d=u,l="立即使用"):e.prizeId&&"redPacket"===e.name?(i="csdn-redpack-cash",d=m,l="立即使用"):e.prizeId&&"randomRedPacket"===e.name?(i="csdn-redpack-cash",d=m,l="立即使用"):e.prizeId&&"discountCoupon"===e.name&&(i="csdn-redpack-discount",d=u,l="立即使用");var k="csdn-redpack-sorry"!==i?"https://g.csdnimg.cn/common/redpack/images/redpack-hasluck.png":"https://g.csdnimg.cn/common/redpack/images/redpack-noluck.png",h=$('<div class="csdn-redpack-result">\n                   \n                    <a class="csdn-redpack-result-link" href="'+(e.url?e.url:"javascript:;")+'" '+(e.url&&!o?'target="_blank"':"")+">"+l+'</a>\n                    <div class="csdn-redpack-area">\n                      <img src='+k+" />\n                      "+d+'\n                    </div>\n                    <em class="csdn-redpack-result-close"></em>\n                </div>');this.el.append(h),s({spm:"3001.6653"}),void 0,h.find(".csdn-redpack-result-close").on("click",function(e){t("redpack",n.courentId,n.localRedPackIdTime),n.destory().getRedPackInfo()}),h.find(".csdn-redpack-result-link").on("click",function(e){r({spm:"3001.6026"}),t("redpack",n.courentId,n.localRedPackIdTime),n.destory().getRedPackInfo()}),n.redpackCheck()},p.prototype.timeLine=function(e){if(e){void 0;var t=this;clearInterval(t.timeLineTimer),t.timeLineTimer=setInterval(function(){if(void 0,!c())return void t.destory();o(e)&&t.currentRedPackId!==e.id&&(window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.close(),t.renderSelectWindow(e)),i(e)&&(t.destory(),t.getRedPackInfo())},2e4),$(document).off("visibilitychange").on("visibilitychange",function(e){void 0,document.hidden?t.destory():t.getRedPackInfo()})}},p.prototype.destory=function(){return void 0,void 0,void 0,void 0,clearInterval(this.timeLineTimer),clearInterval(this.timeBoxTimer),clearInterval(this.timer),clearInterval(this.autoTimeout),clearInterval(this.redpackCheckTimer),this.el&&this.el.remove(),$(".csdn-redpack-container").remove(),$(".csdn-reapck-select").remove(),$("body").find(".csdn-redpack-lottery-btn-box").remove(),$(".redpack-select-noluck").remove(),this.rains=[],this.density=300,this.maxCount=Math.floor(2*Math.random()+1),this.maxTime=10,this.currentRedPackId=null,this.abandonRed=!1,this.autoTimeout=null,this.timeBox=null,this.redpackCheckTimer=null,this},p.prototype.isShowedRedpack=function(e){return e==n("redpack")},p.prototype.renderLotteryBtn=function(e){var o=this,i=window.location.host,c=window.location.pathname,a="",s="",p="",u="";if(this.currentRedPackId=e.id,Number(n("redpack_unlogin_click"))===e.id&&d())return void this.initRedPack(e);if(i.indexOf("blog.csdn.net")>=0?"/"===c?a=".container":2===c.split("/").length?a=$(".user-profile-body-right").length?".user-profile-body-right":".container":c.split("/").length>2&&c.indexOf("/article/details")>=0&&(a=".main_father"):a=i.indexOf("download.csdn.net")>=0?".main":i.indexOf("edu.csdn.net")>=0&&0===c.indexOf("/course/detail")?".right":i.indexOf("marketing.csdn.net")>=0?".container":i.indexOf("mall.csdn.net")>=0&&0===c.indexOf("/lottery-draw")?".home_wrap":"",a){if(s=$(a),".right"===a)p=s.width()+s.offset().left-20,u="bottom: 375px;";else if(".main_father"===a){p=-100;var m=setInterval(function(){$(".csdn-side-toolbar")&&$(".csdn-side-toolbar").offset()&&($(".csdn-redpack-lottery-btn-box").css({left:$(".csdn-side-toolbar").offset().left-20}),clearInterval(m))},500)}else p=s.width()+s.offset().left-20;var k=d()?"点我抢红包啦!":"快快快！登录CSDN抢红包啦！",h=$('<div class="csdn-redpack-lot\n      tery-btn-box" style="left: '+p+"px;"+u+'" data-report-view=\'{"spm": "3001.6025"}\'>\n        <div class="lottery-btn-box-content">\n          <img src="https://g.csdnimg.cn/common/redpack/images/lottery-monkey.gif" alt="">\n        </div>\n        <div class="lottery-btn-box-hint '+(d()?"lottery-login-hint":"lottery-unlogin-hint")+'">'+k+'</div>\n        <div class="lottery-btn-box-close"></div>\n      </div>');h.on("click",".lottery-btn-box-content",function(){d()?o.initRedPack(e):(window.csdn.loginBox.show(),t("redpack_unlogin_click",e.id,o.localRedPackIdTime)),r({spm:"3001.6025",extra:JSON.stringify({isLogin:d()})})}).on("click",".lottery-btn-box-close",function(){return $("body").find(".csdn-redpack-lottery-btn-box").remove(),t("redpack_close_time",1,864e5),r({spm:"3001.6026"}),!1}),$("body").append(h),l()}},p.prototype.renderSelectWindow=function(e){var o=this;this.destory();var i=d()?1e4:6e4;if(Number(n("redpack_unlogin_click"))===e.id&&d())return void this.selectLucky(e);var c=this,a=$('<div class="csdn-reapck-select">\n      <div class="redpack-select-back">\n      <div class="redpack-select-container">\n        <div class="redpack-select-go"></div>\n        <div class="redpack-select-return"></div>\n      </div>\n    </div>');return $("body").append(a),a.on("click",".redpack-select-go",function(){if(a.remove(),!d())return t("redpack_unlogin_click",e.id,c.localRedPackIdTime),void(window.location.href="https://passport.csdn.net/account/login?utm_source=redpack&from="+encodeURIComponent(window.location.href));r({spm:"3001.6654"}),c.selectLucky(e)}).on("click",".redpack-select-return",function(){a.remove(),r({spm:"3001.6652"}),c.removeSelect()}),s({spm:"3001.6652"}),this.autoTimeout=setTimeout(function(){a.remove(),o.selectLucky(e)},i),this},p.prototype.selectLucky=function(e){d()&&t("redpack",e.id,this.localRedPackIdTime),this.initRedPack(e)},p.prototype.removeSelect=function(){$(".csdn-reapck-select").remove(),d()?t("redpack_close_time",1,864e5):t("redpack_close_time",1,36e5),clearTimeout(this.autoTimeout),this.autoTimeout=null,d()&&this.sendGift()},p.prototype.sendGift=function(){window.csdn&&window.csdn.toolbarData&&window.csdn.toolbarData.redpackData&&!window.csdn.toolbarData.redpackData.defaultSendCoupon||(this.giftId&&this.luckyBoy(this.giftId),this.abandonRed=!!this.giftId)},p.prototype.renderNoluck=function(e){var t=this,n=$('<div class="redpack-select-noluck">\n      <div class="redpack-select-noluck-back"></div>\n      <div class="redpack-select-noluck-area">\n        <em class="redpack-select-noluck-close"></em>\n        <div class="redpack-select-noluck-text">\n          <p>很遗憾～</p>\n          <p>赠送您一张<span>¥'+e.money+'</span>VIP抵扣券</p>\n          <p>已直接放入您的钱包</p>\n        </div>\n        <a class="redpack-select-noluck-go" href="'+(e.url?e.url:"javascript:;")+'" '+(e.url&&!a()?'target="_blank"':"")+">立即使用</a>\n      </div>\n    </div>");$("body").append(n),n.on("click",".redpack-select-noluck-go",function(){t.destory().getRedPackInfo()}).on("click",".redpack-select-noluck-close",function(){n.remove(),t.destory().getRedPackInfo()})},p.prototype.redpackCheck=function(){var e=this;clearInterval(this.redpackCheckTimer),this.redpackCheckTimer="",this.redpackCheckTimer=setInterval(function(){i({endTime:n("redpack_out_time")})&&e.destory().getRedPackInfo()},2e4)},window.csdn=window.csdn||{},window.csdn.redpack=new p}();